<md-card>
    <md-card-title>
        <md-card-title-text>
            <div class="row row-inherit">
                <div class="lvg-headline"><span data-translate>card.people</span></div>
                <span class="flex"></span>
                <md-button data-lvg-has-permission="UPDATE_CARD" ng-if="!$ctrl.isAssigned()" class="lvg-small-icon-button" ng-click="$ctrl.take()">
                    <md-tooltip>{{'card.people.take' | translate}}</md-tooltip>
                    <md-icon md-svg-icon="take"></md-icon>
                </md-button>
                <md-button data-lvg-has-permission="UPDATE_CARD" ng-if="$ctrl.isAssigned()" class="lvg-small-icon-button" ng-click="$ctrl.surrender()">
                    <md-tooltip>{{'card.people.surrender' | translate}}</md-tooltip>
                    <md-icon md-svg-icon="surrender"></md-icon>
                </md-button>
                <md-button data-lvg-has-permission="UPDATE_CARD" ng-if="!$ctrl.isWatching()" class="lvg-small-icon-button" ng-click="$ctrl.watchCard()">
                    <md-tooltip>{{'card.people.watch' | translate}}</md-tooltip>
                    <md-icon md-svg-icon="notifications"></md-icon>
                </md-button>
                <md-button data-lvg-has-permission="UPDATE_CARD" ng-if="$ctrl.isWatching()" class="lvg-small-icon-button" ng-click="$ctrl.unWatchCard()">
                    <md-tooltip>{{'card.people.unwatch' | translate}}</md-tooltip>
                    <md-icon md-svg-icon="notifications-off"></md-icon>
                </md-button>
            </div>
        </md-card-title-text>
    </md-card-title>
    <md-card-content>
        <div class="lvg-card-people__assigned">
            <md-list ng-if="$ctrl.assignedUsers">
                <md-list-item class="lvg-card-people__user" data-ng-repeat="user in $ctrl.assignedUsers">
                    <lvg-card-people-user user-id="user.value.valueUser"></lvg-card-people-user>
                    <md-button class="lvg-small-icon-button md-secondary" data-lvg-has-permission="UPDATE_CARD" ng-click="$ctrl.removeAssignForUser(user);">
                        <md-tooltip>{{'card.people.unassign' | translate}}</md-tooltip>
                        <md-icon md-svg-icon="close"></md-icon>
                    </md-button>
                </md-list-item>
            </md-list>
            <div ng-if="!$ctrl.assignedUsers"><i class="lvg-card-people__no-user" data-translate>card.people.assignedToNone</i></div>
        </div>
        <div class="lvg-card-people__watching" ng-if="$ctrl.watchingUsers">
            <md-divider></md-divider>
            <div class="lvg-card-people__watching-count">
                <ng-pluralize class="lvg-card-people__watching-count" count="$ctrl.watchingUsers.length"
                              when="{'1': ('card.people.watchedByOne'|translate),
                     'other': ('card.people.watchedByMany' | translate:{count: '{{$ctrl.watchingUsers.length}}'})}">
                </ng-pluralize>
                <md-button ng-hide="watchExpanded" class="lvg-small-icon-button" ng-click="watchExpanded = true;">
                    <md-tooltip>{{'card.people.showWatchedUsers' | translate}}</md-tooltip>
                    <md-icon md-svg-icon="expand_more"></md-icon>
                </md-button>
                <md-button ng-show="watchExpanded" class="lvg-small-icon-button" ng-click="watchExpanded = false;">
                    <md-tooltip>{{'card.people.hideWatchedUsers' | translate}}</md-tooltip>
                    <md-icon md-svg-icon="expand_less"></md-icon>
                </md-button>
            </div>
            <div ng-if="watchExpanded">
                <md-list>
                    <md-list-item class="lvg-card-people__user" data-ng-repeat="user in $ctrl.watchingUsers">
                        <lvg-card-people-user user-id="user.value.valueUser"></lvg-card-people-user>
                    </md-list-item>
                </md-list>
            </div>
        </div>
    </md-card-content>
    <md-card-actions data-lvg-has-permission="UPDATE_CARD" class="lvg-card-people__actions">
        <form data-ng-submit="$ctrl.assignUser(user)">
            <div class="row margin-8 start-xs bottom-xs">
                <div class="flex">
                    <md-autocomplete
                        md-no-cache="true"
                        md-selected-item="user"
                        md-search-text="userSearchText"
                        md-item-text="user.label"
                        md-items="user in $ctrl.searchUser(userSearchText)"
                        md-floating-label="User"
                        class="lvg-autocomplete__inline flex">
                        <md-item-template>{{user.label}}</md-item-template>
                    </md-autocomplete>
                </div>
                <div class="flex no-grow">
                    <md-button class="md-primary" type="submit" ng-disabled="!user">
                        <span data-translate>button.assign</span>
                    </md-button>
                </div>
            </div>
        </form>
    </md-card-actions>
</md-card>
